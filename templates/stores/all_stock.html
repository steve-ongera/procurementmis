<!-- ============================================================================ -->
<!-- 6. all_stock.html -->
<!-- ============================================================================ -->
{% extends 'base.html' %}
{% load humanize %}

{% block title %}All Stock - Stores Management{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1 class="page-title">All Stock Items</h1>
        <div class="breadcrumb">
            <a href="{% url 'dashboard' %}"><i class="bi bi-house"></i> Home</a>
            <i class="bi bi-chevron-right"></i>
            <a href="{% url 'stores_dashboard' %}">Stores</a>
            <i class="bi bi-chevron-right"></i>
            <span>All Stock</span>
        </div>
    </div>
    <div class="header-actions">
        <a href="{% url 'store_add_stock_item' %}" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Add Stock Item
        </a>
    </div>
</div>

<div class="summary-grid">
    <div class="summary-card">
        <div class="summary-value">{{ stats.total_items }}</div>
        <div class="summary-label">Total Items</div>
    </div>
    <div class="summary-card">
        <div class="summary-value">KES {{ stats.total_value|floatformat:0|intcomma }}</div>
        <div class="summary-label">Total Value</div>
    </div>
    <div class="summary-card">
        <div class="summary-value">{{ stats.low_stock }}</div>
        <div class="summary-label">Low Stock</div>
    </div>
    <div class="summary-card">
        <div class="summary-value">{{ stats.out_of_stock }}</div>
        <div class="summary-label">Out of Stock</div>
    </div>
</div>

<div class="filter-card">
    <form method="get">
        <div class="filter-grid">
            <div class="form-group">
                <label>Search</label>
                <input type="text" name="search" class="form-control" placeholder="Item name or code">
            </div>
            <div class="form-group">
                <label>Store</label>
                <select name="store" class="form-control">
                    <option value="">All Stores</option>
                    {% for store in stores %}
                    <option value="{{ store.id }}">{{ store.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label>Category</label>
                <select name="category" class="form-control">
                    <option value="">All Categories</option>
                    <!-- Add categories here -->
                </select>
            </div>
        </div>
        <div class="filter-actions">
            <button type="submit" class="btn btn-primary">Apply Filters</button>
        </div>
    </form>
</div>

<div class="table-card">
    <div class="table-header">
        <h2 class="table-title">
            <i class="bi bi-box"></i> Stock Items ({{ stock_items.count }})
        </h2>
    </div>
    {% if stock_items %}
    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>Item Code</th>
                    <th>Item Name</th>
                    <th>Store</th>
                    <th>Quantity on Hand</th>
                    <th>Reorder Level</th>
                    <th>Avg Unit Cost</th>
                    <th>Total Value</th>
                    <th>Last Restock</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for stock in stock_items %}
                <tr {% if stock.quantity_on_hand <= stock.reorder_level %}class="low-stock"{% endif %}>
                    <td>{{ stock.item.code }}</td>
                    <td>{{ stock.item.name }}</td>
                    <td>{{ stock.store.name }}</td>
                    <td>
                        {{ stock.quantity_on_hand }}
                        {% if stock.quantity_on_hand <= stock.reorder_level %}
                        <i class="bi bi-exclamation-triangle text-warning"></i>
                        {% endif %}
                    </td>
                    <td>{{ stock.reorder_level }}</td>
                    <td>KES {{ stock.average_unit_cost|floatformat:2 }}</td>
                    <td>KES {{ stock.total_value|floatformat:0|intcomma }}</td>
                    <td>{{ stock.last_restock_date|date:"M d, Y"|default:"Never" }}</td>
                    <td>
                        <a href="#" class="btn-sm"><i class="bi bi-eye"></i></a>
                        <a href="#" class="btn-sm"><i class="bi bi-pencil"></i></a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <i class="bi bi-box"></i>
        <p>No stock items found</p>
    </div>
    {% endif %}
</div>
{% endblock %}
