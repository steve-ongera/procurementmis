{% extends 'base.html' %}
{% load static %}
{% block title %}Help Center - University Procurement System{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
<style>
    :root {
        --primary-color: #2563EB;
        --primary-light: #EFF6FF;
        --primary-dark: #1D4ED8;
        --secondary-color: #64748B;
        --success-color: #10B981;
        --warning-color: #F59E0B;
        --danger-color: #EF4444;
        --border-color: #E2E8F0;
        --card-bg: #FFFFFF;
        --hover-bg: #F8FAFC;
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .page-title {
        font-size: 1.75rem;
        font-weight: 600;
        color: #1E293B;
        margin: 0 0 0.5rem 0;
    }

    .page-subtitle {
        font-size: 1rem;
        color: var(--secondary-color);
        margin: 0;
    }

    /* Quick Links Grid */
    .quick-links-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .quick-link-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 0.5rem;
        padding: 1.5rem;
        text-decoration: none;
        transition: all 0.2s;
    }

    .quick-link-card:hover {
        border-color: var(--primary-color);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        transform: translateY(-2px);
    }

    .quick-link-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 3rem;
        height: 3rem;
        border-radius: 0.5rem;
        background: var(--primary-light);
        color: var(--primary-color);
        font-size: 1.5rem;
        margin-bottom: 1rem;
    }

    .quick-link-card h3 {
        font-size: 1rem;
        font-weight: 600;
        color: #1E293B;
        margin: 0 0 0.5rem 0;
    }

    .quick-link-card p {
        font-size: 0.875rem;
        color: var(--secondary-color);
        margin: 0;
        line-height: 1.5;
    }

    /* Search Box */
    .search-box {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 0.5rem;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }

    .search-container {
        position: relative;
        max-width: 600px;
        margin: 0 auto;
    }

    .search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--secondary-color);
        font-size: 1rem;
    }

    .search-container input {
        width: 100%;
        padding: 0.75rem 1rem 0.75rem 3rem;
        border: 1px solid var(--border-color);
        border-radius: 0.375rem;
        font-size: 0.875rem;
        transition: all 0.2s;
    }

    .search-container input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    /* FAQ Sections */
    .faq-section {
        margin-bottom: 3rem;
    }

    .faq-section:last-child {
        margin-bottom: 0;
    }

    .faq-section-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1E293B;
        margin: 0 0 1.5rem 0;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .faq-section-title i {
        color: var(--primary-color);
        font-size: 1.25rem;
    }

    .faq-item {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 0.375rem;
        margin-bottom: 0.75rem;
        overflow: hidden;
    }

    .faq-item:last-child {
        margin-bottom: 0;
    }

    .faq-question {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 1.25rem;
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .faq-question:hover {
        background: var(--hover-bg);
    }

    .faq-question h3 {
        font-size: 0.875rem;
        font-weight: 600;
        color: #334155;
        margin: 0;
        flex: 1;
    }

    .faq-question i {
        color: var(--secondary-color);
        font-size: 1rem;
        transition: transform 0.2s;
        margin-left: 1rem;
        flex-shrink: 0;
    }

    .faq-item.active .faq-question i {
        transform: rotate(180deg);
        color: var(--primary-color);
    }

    .faq-answer {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out;
        border-top: 1px solid transparent;
    }

    .faq-item.active .faq-answer {
        border-top-color: var(--border-color);
    }

    .faq-answer-content {
        padding: 1.25rem;
    }

    .faq-answer p,
    .faq-answer ol,
    .faq-answer ul {
        font-size: 0.875rem;
        color: var(--secondary-color);
        line-height: 1.5;
        margin: 0 0 1rem 0;
    }

    .faq-answer p:last-child,
    .faq-answer ol:last-child,
    .faq-answer ul:last-child {
        margin-bottom: 0;
    }

    .faq-answer ol,
    .faq-answer ul {
        padding-left: 1.5rem;
        margin-bottom: 1rem;
    }

    .faq-answer li {
        margin-bottom: 0.5rem;
    }

    /* Help CTA */
    .help-cta {
        background: linear-gradient(135deg, var(--primary-light) 0%, #E0E7FF 100%);
        border: 1px solid #BFDBFE;
        border-radius: 0.5rem;
        padding: 2rem;
        text-align: center;
        margin: 3rem 0;
    }

    .help-cta-content i {
        font-size: 3rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
    }

    .help-cta-content h3 {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1E293B;
        margin: 0 0 0.5rem 0;
    }

    .help-cta-content p {
        font-size: 0.875rem;
        color: var(--secondary-color);
        margin: 0 0 1.5rem 0;
        line-height: 1.5;
    }

    .help-cta-actions {
        display: flex;
        gap: 0.75rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    /* Info Card */
    .info-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 0.5rem;
        padding: 2rem;
    }

    .card-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1E293B;
        margin: 0 0 1.5rem 0;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid var(--border-color);
    }

    .contact-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
    }

    .contact-item {
        display: flex;
        gap: 1rem;
        align-items: flex-start;
    }

    .contact-item i {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 0.5rem;
        background: var(--primary-light);
        color: var(--primary-color);
        font-size: 1.25rem;
        flex-shrink: 0;
    }

    .contact-item strong {
        display: block;
        font-size: 0.875rem;
        font-weight: 600;
        color: #475569;
        margin-bottom: 0.25rem;
    }

    .contact-item p {
        font-size: 0.875rem;
        color: var(--secondary-color);
        margin: 0;
        line-height: 1.5;
    }

    /* Buttons */
    .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.625rem 1.5rem;
        border-radius: 0.375rem;
        font-weight: 500;
        font-size: 0.875rem;
        text-decoration: none;
        transition: all 0.2s;
        border: 1px solid var(--border-color);
        cursor: pointer;
        background: var(--card-bg);
        color: var(--secondary-color);
    }

    .btn:hover {
        background: var(--hover-bg);
        transform: translateY(-1px);
    }

    .btn-primary {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }

    .btn-primary:hover {
        background: var(--primary-dark);
        border-color: var(--primary-dark);
    }

    .btn-secondary {
        background: var(--card-bg);
        color: var(--secondary-color);
        border-color: var(--border-color);
    }

    .btn-secondary:hover {
        background: #F1F5F9;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .page-header {
            flex-direction: column;
            align-items: stretch;
        }
        
        .quick-links-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .contact-grid {
            grid-template-columns: 1fr;
        }
        
        .help-cta-actions {
            flex-direction: column;
        }
        
        .help-cta-actions .btn {
            width: 100%;
            justify-content: center;
        }
        
        .btn {
            width: 100%;
            justify-content: center;
        }
    }

    @media (max-width: 640px) {
        .quick-links-grid {
            grid-template-columns: 1fr;
        }
        
        .btn {
            width: 100%;
            justify-content: center;
        }
        
        .faq-section {
            margin-bottom: 2rem;
        }
        
        .help-cta {
            padding: 1.5rem;
            margin: 2rem 0;
        }
        
        .info-card {
            padding: 1.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1 class="page-title">Help Center</h1>
        <p class="page-subtitle">Frequently asked questions and support resources</p>
    </div>
    <a href="{% url 'supplier_contact_support' %}" class="btn btn-primary">
        <i class="bi bi-headset"></i> Contact Support
    </a>
</div>

<!-- Quick Links -->
<div class="quick-links-grid">
    <a href="#getting-started" class="quick-link-card">
        <div class="quick-link-icon">
            <i class="bi bi-play-circle"></i>
        </div>
        <h3>Getting Started</h3>
        <p>Learn the basics of using the portal</p>
    </a>
    
    <a href="#tenders" class="quick-link-card">
        <div class="quick-link-icon">
            <i class="bi bi-file-earmark-text"></i>
        </div>
        <h3>Tendering Process</h3>
        <p>How to find and bid on tenders</p>
    </a>
    
    <a href="#invoices" class="quick-link-card">
        <div class="quick-link-icon">
            <i class="bi bi-receipt"></i>
        </div>
        <h3>Invoices & Payments</h3>
        <p>Submitting invoices and tracking payments</p>
    </a>
    
    <a href="#compliance" class="quick-link-card">
        <div class="quick-link-icon">
            <i class="bi bi-shield-check"></i>
        </div>
        <h3>Compliance</h3>
        <p>Document requirements and certifications</p>
    </a>
</div>

<!-- Search Box -->
<div class="search-box">
    <div class="search-container">
        <i class="bi bi-search search-icon"></i>
        <input type="text" class="form-control" id="faqSearch" 
               placeholder="Search for help articles..." onkeyup="searchFAQs()">
    </div>
</div>

<!-- FAQ Sections -->
<div class="faq-container">
    <!-- Getting Started -->
    <div class="faq-section" id="getting-started">
        <h2 class="faq-section-title">
            <i class="bi bi-play-circle"></i>
            Getting Started
        </h2>
        
        {% for faq in faqs %}
        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <h3>{{ faq.question }}</h3>
                <i class="bi bi-chevron-down"></i>
            </div>
            <div class="faq-answer">
                <div class="faq-answer-content">
                    <p>{{ faq.answer }}</p>
                </div>
            </div>
        </div>
        {% endfor %}
        
        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <h3>How do I register as a supplier?</h3>
                <i class="bi bi-chevron-down"></i>
            </div>
            <div class="faq-answer">
                <div class="faq-answer-content">
                    <p>To register as a supplier:</p>
                    <ol>
                        <li>Click on "Register as Supplier" on the homepage</li>
                        <li>Fill in your company details and contact information</li>
                        <li>Upload required documents (Business Registration, Tax Certificate)</li>
                        <li>Submit your application for approval</li>
                        <li>Wait for verification (typically 3-5 business days)</li>
                    </ol>
                </div>
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <h3>How do I update my company profile?</h3>
                <i class="bi bi-chevron-down"></i>
            </div>
            <div class="faq-answer">
                <div class="faq-answer-content">
                    <p>Navigate to "Company Profile" from your dashboard menu. Update your information and click "Save Changes". Important changes may require re-verification.</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tenders & Bidding -->
    <div class="faq-section" id="tenders">
        <h2 class="faq-section-title">
            <i class="bi bi-file-earmark-text"></i>
            Tenders & Bidding
        </h2>
        
        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <h3>How do I find available tenders?</h3>
                <i class="bi bi-chevron-down"></i>
            </div>
            <div class="faq-answer">
                <div class="faq-answer-content">
                    <p>Go to "Available Tenders" in your dashboard. You can filter tenders by category, value, and closing date. Tenders matching your business categories are highlighted.</p>
                </div>
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <h3>What documents do I need to submit with my bid?</h3>
                <i class="bi bi-chevron-down"></i>
            </div>
            <div class="faq-answer">
                <div class="faq-answer-content">
                    <p>Required documents typically include:</p>
                    <ul>
                        <li>Technical proposal</li>
                        <li>Financial proposal (price breakdown)</li>
                        <li>Current tax compliance certificate</li>
                        <li>Business registration certificate</li>
                        <li>Completed tender forms</li>
                        <li>Any other documents specified in the tender document</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <h3>Can I submit a bid after the closing date?</h3>
                <i class="bi bi-chevron-down"></i>
            </div>
            <div class="faq-answer">
                <div class="faq-answer-content">
                    <p>No, the system automatically closes tender submissions at the specified closing date and time. Late submissions are not accepted. Ensure you submit well before the deadline.</p>
                </div>
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <h3>How will I know if my bid was successful?</h3>
                <i class="bi bi-chevron-down"></i>
            </div>
            <div class="faq-answer">
                <div class="faq-answer-content">
                    <p>You will receive notifications via email and in your dashboard. Check "My Bids" section regularly for bid status updates. Successful bidders will receive a Letter of Award.</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Invoices & Payments -->
    <div class="faq-section" id="invoices">
        <h2 class="faq-section-title">
            <i class="bi bi-receipt"></i>
            Invoices & Payments
        </h2>
        
        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <h3>How do I submit an invoice?</h3>
                <i class="bi bi-chevron-down"></i>
            </div>
            <div class="faq-answer">
                <div class="faq-answer-content">
                    <p>After delivering goods/services:</p>
                    <ol>
                        <li>Go to "Invoices" and click "Submit New Invoice"</li>
                        <li>Select the relevant Purchase Order</li>
                        <li>Fill in invoice details and line items</li>
                        <li>Upload supporting documents (delivery note, receipts)</li>
                        <li>Submit for verification</li>
                    </ol>
                </div>
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <h3>When will I receive payment?</h3>
                <i class="bi bi-chevron-down"></i>
            </div>
            <div class="faq-answer">
                <div class="faq-answer-content">
                    <p>Payments are typically processed within 7-14 business days after invoice approval. Bulk payments are usually made on the 15th and last day of each month. Track your payment status in the "Payments" section.</p>
                </div>
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <h3>Why was my invoice disputed?</h3>
                <i class="bi bi-chevron-down"></i>
            </div>
            <div class="faq-answer">
                <div class="faq-answer-content">
                    <p>Invoices may be disputed due to:</p>
                    <ul>
                        <li>Mismatch between invoice and purchase order</li>
                        <li>Missing or incorrect documentation</li>
                        <li>Quality issues with delivered goods/services</li>
                        <li>Pricing discrepancies</li>
                    </ul>
                    <p>Check the dispute reason in your invoice details and contact the procurement office to resolve.</p>
                </div>
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <h3>How do I update my banking details?</h3>
                <i class="bi bi-chevron-down"></i>
            </div>
            <div class="faq-answer">
                <div class="faq-answer-content">
                    <p>Go to "Company Profile" and update your banking information. Changes to banking details may require verification before taking effect.</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Compliance & Documents -->
    <div class="faq-section" id="compliance">
        <h2 class="faq-section-title">
            <i class="bi bi-shield-check"></i>
            Compliance & Documents
        </h2>
        
        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <h3>What documents are required to maintain supplier status?</h3>
                <i class="bi bi-chevron-down"></i>
            </div>
            <div class="faq-answer">
                <div class="faq-answer-content">
                    <p>Required documents include:</p>
                    <ul>
                        <li>Valid Business Registration Certificate</li>
                        <li>Current Tax Compliance Certificate (renewed annually)</li>
                        <li>Bank Statement (updated quarterly)</li>
                        <li>Professional licenses relevant to your category</li>
                        <li>Insurance certificates (if applicable)</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <h3>How often should I update my documents?</h3>
                <i class="bi bi-chevron-down"></i>
            </div>
            <div class="faq-answer">
                <div class="faq-answer-content">
                    <p>You'll receive notifications 30 days before document expiry. Update documents promptly to avoid suspension. Tax compliance should be renewed annually, and other documents as per their expiry dates.</p>
                </div>
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <h3>What happens if my documents expire?</h3>
                <i class="bi bi-chevron-down"></i>
            </div>
            <div class="faq-answer">
                <div class="faq-answer-content">
                    <p>If critical documents (Tax Compliance, Business Registration) expire, your account may be suspended. You won't be able to bid on new tenders or submit invoices until documents are updated.</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Technical Support -->
    <div class="faq-section" id="technical">
        <h2 class="faq-section-title">
            <i class="bi bi-gear"></i>
            Technical Support
        </h2>
        
        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <h3>I forgot my password. How do I reset it?</h3>
                <i class="bi bi-chevron-down"></i>
            </div>
            <div class="faq-answer">
                <div class="faq-answer-content">
                    <p>Click "Forgot Password" on the login page. Enter your email address and follow the instructions sent to your email to reset your password.</p>
                </div>
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <h3>What file formats are accepted for uploads?</h3>
                <i class="bi bi-chevron-down"></i>
            </div>
            <div class="faq-answer">
                <div class="faq-answer-content">
                    <p>Accepted formats: PDF, JPG, JPEG, PNG. Maximum file size is 5MB per document. For larger files, please compress or split them.</p>
                </div>
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <h3>I'm experiencing technical issues. Who do I contact?</h3>
                <i class="bi bi-chevron-down"></i>
            </div>
            <div class="faq-answer">
                <div class="faq-answer-content">
                    <p>Contact our technical support team at support@university.ac.ke or use the "Contact Support" button. Include details about the issue and screenshots if possible.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Still Need Help -->
<div class="help-cta">
    <div class="help-cta-content">
        <i class="bi bi-question-circle"></i>
        <h3>Still need help?</h3>
        <p>Can't find what you're looking for? Our support team is here to help.</p>
        <div class="help-cta-actions">
            <a href="{% url 'supplier_contact_support' %}" class="btn btn-primary">
                <i class="bi bi-envelope"></i> Contact Support
            </a>
            <a href="tel:+254XXXXXXXXX" class="btn btn-secondary">
                <i class="bi bi-telephone"></i> Call Us
            </a>
        </div>
    </div>
</div>

<!-- Contact Information -->
<div class="info-card">
    <h3 class="card-title">Contact Information</h3>
    <div class="contact-grid">
        <div class="contact-item">
            <i class="bi bi-envelope"></i>
            <div>
                <strong>Email</strong>
                <p>procurement@university.ac.ke</p>
            </div>
        </div>
        <div class="contact-item">
            <i class="bi bi-telephone"></i>
            <div>
                <strong>Phone</strong>
                <p>+254 XXX XXX XXX</p>
            </div>
        </div>
        <div class="contact-item">
            <i class="bi bi-clock"></i>
            <div>
                <strong>Office Hours</strong>
                <p>Monday - Friday, 8:00 AM - 5:00 PM</p>
            </div>
        </div>
        <div class="contact-item">
            <i class="bi bi-geo-alt"></i>
            <div>
                <strong>Location</strong>
                <p>Procurement Office, Main Campus</p>
            </div>
        </div>
    </div>
</div>

<script>
function toggleFAQ(element) {
    const faqItem = element.parentElement;
    const answer = faqItem.querySelector('.faq-answer');
    const icon = element.querySelector('i');
    
    // Toggle current FAQ
    const isActive = faqItem.classList.contains('active');
    
    // Close all other FAQs
    document.querySelectorAll('.faq-item').forEach(item => {
        item.classList.remove('active');
        item.querySelector('.faq-answer').style.maxHeight = null;
        item.querySelector('.faq-question i').style.transform = 'rotate(0deg)';
    });
    
    // If it wasn't active before, open it
    if (!isActive) {
        faqItem.classList.add('active');
        answer.style.maxHeight = answer.scrollHeight + 'px';
        icon.style.transform = 'rotate(180deg)';
    }
}

function searchFAQs() {
    const input = document.getElementById('faqSearch');
    const filter = input.value.toUpperCase();
    const faqItems = document.querySelectorAll('.faq-item');
    
    let foundAny = false;
    
    faqItems.forEach(item => {
        const question = item.querySelector('.faq-question h3').textContent;
        const answer = item.querySelector('.faq-answer').textContent;
        
        if (question.toUpperCase().includes(filter) || answer.toUpperCase().includes(filter)) {
            item.style.display = '';
            foundAny = true;
            
            // Open parent section if needed
            const section = item.closest('.faq-section');
            if (section) {
                section.style.display = '';
            }
        } else {
            item.style.display = 'none';
        }
    });
    
    // Hide empty sections
    document.querySelectorAll('.faq-section').forEach(section => {
        const visibleItems = section.querySelectorAll('.faq-item[style=""]').length;
        if (visibleItems === 0) {
            section.style.display = 'none';
        } else {
            section.style.display = '';
        }
    });
}
</script>

{% endblock %}